# NHC Configuration File (sample)
#
# Lines are in the form "<hostmask>||<check>"
# Hostmask is a glob, /regexp/, or {noderange}
# Comments begin with '#'
#
# $Id: nhc.conf 1774 2014-09-20 02:59:19Z mej $
#

#######################################################################
###
### NHC Configuration Variables
###
# Do not mark nodes offline
#   * || export MARK_OFFLINE=0

#######################################################################
###
### Hardware checks
###
# Set these to your correct socket, core, and thread counts.
  *compa* || check_hw_cpuinfo 2 12 12
  *compb* || check_hw_cpuinfo 2 12 12
  *compc* || check_hw_cpuinfo 2 16 16
  *compd* || check_hw_cpuinfo 2 20 20
  *compe* || check_hw_cpuinfo 2 24 24
  *gpu* || check_hw_cpuinfo 2 12 12

# Set these to the amount of physical RAM you have (leave the fudge factor).
   *compa* || check_hw_physmem 24gb 24gb 5%
   *compb* || check_hw_physmem 72gb 72gb 5%
   *compc* || check_hw_physmem 64gb 64gb 5%
   *compd* || check_hw_physmem 128gb 128gb 5%
   *compe* || check_hw_physmem 128gb 128gb 5%
   *gpu* || check_hw_physmem 48gb 48gb 5%

# check for an active IB interface
  *compa*  || check_hw_ib 40
  *compb*  || check_hw_ib 40
  *compc*  || check_hw_ib 56
  *compd*  || check_hw_ib 40
  *compe*  || check_hw_ib 56
  *gpu*  || check_hw_ib 40


#######################################################################
###
### Filesystem checks
###
# All nodes should have their root filesystem mounted read/write.
   * || check_fs_mount_rw -f /

# Make sure the root filesystem doesn't get too full.
   * || check_fs_free / 3%

# Free inodes are also important.
   * || check_fs_ifree / 1k

# check if /gpfs is mounted
  *  || check_fs_mount -t gpfs -f /gpfs

#######################################################################
###
### File/metadata checks
###
# These should always be directories and always be read/write/execute and sticky.
   * || check_file_test -r -w -x -d -k /tmp /var/tmp

# These should always be directories and always be read/write/execute and sticky.
   * || check_file_test -r -w -x -d /scratch

# check that /scratch is configured appropriately
   * || check_file_stat -G allusrs -M 0770 /scratch

# These should always be readable and should never be empty.
   * || check_file_test -r -s /etc/passwd /etc/group

# check that /dev/ipmi0 exists
  *  || check_file_test -a /dev/ipmi0

# check that the intel install directory exists
  *  || check_file_test -a /opt/intel


#######################################################################
###
### Process checks
###

# check for any root processes running at over 80% cpu
   * || check_ps_cpu -u root 80%

# Everybody needs sshd running, right?  But don't use -r (restart)!
   * || check_ps_service -u root -S sshd

# Make sure no users are SSH'd in, but don't kill them.
#   * || check_ps_blacklist sshd '!root'

# This is only valid for RHEL6 and similar/newer systems.
   * || check_ps_service -d rsyslogd -r rsyslog

# Check for NTP running on node, and restart if not
   *compb* || check_ps_service -S ntpd

# Check for MUNGE running on node, and restart if not
   * || check_ps_service -d munged -S munge

# Check for SSSD running on node, and restart if not
   * || check_ps_service -S sssd

# Double your core count is a good rule of thumb for load average max.
   *compa* || check_ps_loadavg 13
   *compb* || check_ps_loadavg 13
   *compc* || check_ps_loadavg 17
   *compd* || check_ps_loadavg 21
   *compe* || check_ps_loadavg 25

#######################################################################
###
### Other checks
###
# Check to verify that SELinux is disabled.  (Remove the "-r 1" to verify it's enabled.)
   * || check_cmd_status -t 1 -r 1 selinuxenabled

# Verify settings for an Ethernet interface.
#   * || check_cmd_output -m '/addr:10\.0\.0\.1/' -m '/Bcast:10\.0\.0\.255/' -m '/Mask:255\.255\.255\.0/' -m '/^[[:space:]]*UP /' /sbin/ifconfig eth3

# nVidia HealthMon GPU health checks (requires Tesla Development Kit)
   *gpu* || check_nv_healthmon
